<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Watch Better</title>
        <!-- plugins:css -->
        <link rel="stylesheet" href="assets/vendors/mdi/css/materialdesignicons.min.css">
        <link rel="stylesheet" href="assets/vendors/flag-icon-css/css/flag-icon.min.css">
        <link rel="stylesheet" href="assets/vendors/css/vendor.bundle.base.css">
        <!-- endinject -->
        <!-- Plugin css for this page -->
        <link rel="stylesheet" href="assets/vendors/font-awesome/css/font-awesome.min.css" />
        <link rel="stylesheet" href="assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.css">
        <!-- End plugin css for this page -->
        <!-- inject:css -->
        <!-- endinject -->
        <!-- Layout styles -->
        <link rel="stylesheet" href="assets/css/style.css">
        <!-- End layout styles -->
        <link rel="shortcut icon" href="upload/watch better.png" />
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    </head>
    <body>
        <div class="container-scroller">
            
            
            <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
                <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
             </div>
                <div class="navbar-menu-wrapper d-flex align-items-stretch">
                    <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
                        <span class="mdi mdi-menu"></span>
                    </button>
                   
                    <ul class="navbar-nav navbar-nav-right">
                        
                      
                       
                        <li class="nav-item nav-profile dropdown">
                            <a class="nav-link dropdown-toggle" id="profileDropdown" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                                <div class="nav-profile-img">
                                    <img src="upload/admin.png" alt="image">
                                </div>
                                <div class="nav-profile-text">
                                    <p class="mb-1 text-black">Watch Better</p>
                                </div>
                            </a>
                            <div class="dropdown-menu navbar-dropdown dropdown-menu-center p-0 border-1 font-size-sm" aria-labelledby="profileDropdown" data-x-placement="bottom-end">
                                <div class="p-3 text-center bg-primary">
                                    <img class="img-avatar img-avatar48 img-avatar-thumb" src="upload/admin.png" alt="">
                                </div>

                                   
                                    <a class="dropdown-item py-1 d-flex align-items-center justify-content-between" href="#">
                                        <span>Profile</span>
                                        <span class="p-0">
                                            <span class="badge badge-success">1</span>
                                            <i class="mdi mdi-account-outline ms-1"></i>
                                        </span>
                                    </a>
                                    <a class="dropdown-item py-1 d-flex align-items-center justify-content-between" href="javascript:void(0)">
                                        <span>Settings</span>
                                        <i class="mdi mdi-settings"></i>
                                    </a>
                                    <div role="separator" class="dropdown-divider"></div>
                                    <h5 class="dropdown-header text-uppercase  ps-2 text-dark mt-2">Actions</h5>
                                    <a class="dropdown-item py-1 d-flex align-items-center justify-content-between" href="#">
                                        <span>Lock Account</span>
                                        <i class="mdi mdi-lock ms-1"></i>
                                    </a>
                                    <a class="dropdown-item py-1 d-flex align-items-center justify-content-between" href="#">
                                        <span>Log Out</span>
                                        <i class="mdi mdi-logout ms-1"></i>
                                    </a>
<!--                                </div>-->
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            
                            <div class="dropdown-menu dropdown-menu-end navbar-dropdown preview-list" aria-labelledby="messageDropdown">
                               
                                
                                
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item preview-item">
                                    <div class="preview-thumbnail">
                                        <img src="assets/images/faces/face2.jpg" alt="image" class="profile-pic">
                                    </div>
                                   
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item preview-item">
                                    <div class="preview-thumbnail">
                                        <img src="assets/images/faces/face3.jpg" alt="image" class="profile-pic">
                                    </div>
                                  
                                </a>
                                
                        </li>
                        
                              
                  
                
            </nav>
           
            <div class="container-fluid page-body-wrapper">
                
                <nav class="sidebar sidebar-offcanvas" id="sidebar">
                    <ul class="nav">
                        
                        <li class="nav-item">
                            <a class="nav-link" href="home.php">
                                <span class="icon-bg"><i class="mdi mdi-cube menu-icon"></i></span>
                                <span class="menu-title">Dashboard</span>
                            </a>
                        </li>
                       
                        <li class="nav-item">
                            <a class="nav-link" href="Managemovie.php">
                                <span class="icon-bg"><i class="mdi mdi-contacts menu-icon"></i></span>
                                <span class="menu-title">Manage movie</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="screen.php">
                                <span class="icon-bg"><i class="mdi mdi-format-list-bulleted menu-icon"></i></span>
                                <span class="menu-title">Manage Screen</span>
                            </a>
                        </li>
                       
                        <li class="nav-item">
                            <a class="nav-link" href="reports.php">
                                <span class="icon-bg"><i class="mdi mdi-lock menu-icon"></i></span>
                                <span class="menu-title">View reports</span>
                                
                            </a>
                         
                        </li>
                       
                                        
                </nav>
                <!-- partial -->
                <div class="main-panel">
                    <div class="content-wrapper">
                        <div class="d-xl-flex justify-content-between align-items-start">
                            <h2 class="text-dark font-weight-bold mb-2"> Update Movie </h2>
                            <div class="d-sm-flex justify-content-xl-between align-items-center mb-2">
                                
                                <div class="dropdown ms-0 ml-md-4 mt-2 mt-lg-0">
                                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton1">
                                       
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="d-sm-flex justify-content-between align-items-center transaparent-tab-border {">




<?php
// Check if the form is submitted
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Get movie ID from the form
    $id = $_POST['id'];

    // Get the image details
    $image = $_FILES['pic']['name'];
    $temp_image = $_FILES['pic']['tmp_name'];

    // Set the target directory and file path for the image
    $target_dir = "img/";
    $target_file = "upload/" . basename($image);
    
    // Move the uploaded image to the target directory
    if (move_uploaded_file($temp_image, $target_file)) {
        echo "Image uploaded successfully!<br>";
    } else {
//        echo "Error uploading image<br>";
    }

    // Connect to the database (modify with your actual credentials)
    $servername = "localhost";
    $username = "root";
    $password = "";
    $dbname = "in_movie";

    $conn = new mysqli($servername, $username, $password, $dbname);

    // Check the database connection
    if ($conn->connect_error) {
        die("Connection failed: " . $conn->connect_error);
    }

    // Retrieve updated data from the form
    $mname = $_POST['mname'];
    $seat = $_POST['seat'];

    // Construct the SQL query for updating movie details
    $update_sql = "UPDATE insertmovie SET mname = '$mname', seat = '$seat', img = '$target_file' WHERE id = $id";

    if ($conn->query($update_sql) === TRUE) {
        echo "Movie details updated successfully!";
    } else {
        echo "Error updating movie details: " . $conn->error;
    }

    // Close the database connection
    $conn->close();
}

// Retrieve movie details to populate the form
$movie_id = $_GET['id'];
// Connect to the database again to retrieve movie details (modify with your actual credentials)
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "in_movie";

$conn = new mysqli($servername, $username, $password, $dbname);

// Check the database connection
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

$sql = "SELECT * FROM insertmovie WHERE id = $movie_id";
$result = $conn->query($sql);

if ($result->num_rows > 0) {
    $row = $result->fetch_assoc();
} else {
    echo "Movie not found!";
    exit;
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit Movie</title>
</head>
<body>
    
    <form method="POST" enctype="multipart/form-data">
        <input type="hidden" name="id" value="<?php echo $movie_id; ?>">
        
        <!-- Display the current image -->
        <img src="<?php echo $row['img']; ?>" alt="Movie Image" width="100"><br>

        <!-- Allow the user to upload a new image -->
        <label>Insert Movie Pic:</label>
        <input type="file" name="pic"><br><br>

        <label>Movie Name:</label>
        <input type="text" name="mname" value="<?php echo $row['mname']; ?>"><br><br>

        <label>Seat Price:</label>
        <input type="text" name="seat" value="<?php echo $row['seat']; ?>"><br><br>

        <input type="submit" name="update" value="Update Movie">
        <input type="submit" name="update" value="Update Trailer details">
    </form>
</body>
</html>
